[tox]
isolated_build = true
envlist =
    py310-django{40,42,50,51}
    py311-django{40,42,50,51}
    py312-django{42,50,51}
    quality
    security
    build
    docs

[testenv]
description = Run tests with pytest
setenv =
    PYTHONPATH = {toxinidir}
deps =
    pytest
    pytest-django
    pytest-cov
    factory_boy
    coverage[toml]
    django40: Django>=4.0,<4.1
    django42: Django>=4.2,<5.0
    django50: Django>=5.0,<5.1
    django51: Django>=5.1,<5.2
commands =
    pytest tests/ --cov=graphene_django_extras --cov-report=term-missing

[testenv:quality]
description = Code quality checks (black, isort, flake8, mypy)
skip_install = true
deps =
    black>=23.0.0
    isort>=5.0.0
    flake8>=6.0.0
    flake8-docstrings
    flake8-import-order
    flake8-bugbear
    mypy
    types-six
    types-python-dateutil
commands =
    black --check --diff .
    isort --check-only --diff .
    flake8 .
    mypy graphene_django_extras

[testenv:security]
description = Security checks (bandit, safety)
skip_install = true
deps =
    bandit>=1.7.5
    pip-audit
commands =
    bandit -r graphene_django_extras/ -c pyproject.toml
    pip-audit

[testenv:build]
description = Build the package with poetry
skip_install = true
allowlist_externals = poetry
commands =
    poetry build

[testenv:docs]
description = Build the documentation with MkDocs
skip_install = true
deps =
    mkdocs>=1.5.0
    mkdocs-material>=9.4.0
    pymdown-extensions>=10.4.0
commands =
    mkdocs build --clean

[gh-actions]
python =
    3.10: py310-django40, py310-django42, py310-django50, py310-django51
    3.11: py311-django40, py311-django42, py311-django50, py311-django51
    3.12: py312-django42, py312-django50, py312-django51

[flake8]
max-line-length = 88
select = E,W,F,C,N,D
ignore = E203,E501,W503
exclude = .git,__pycache__,.tox,.eggs,*.egg,build,dist,.venv,venv,migrations
per-file-ignores =
    __init__.py:F401
    tests/*:D
